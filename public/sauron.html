<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <script src="socket.io/socket.io.js"></script>
        <script src="./jscolor.min.js"></script>
    </head>
    <body style="background: #FFFFFF;">
        <div id="eyeColor" style="background:#BB0000; height:689px; width:680px;">
            <img src="./White eye.png">
        </div>
        <div>
            Legend: <br />
            Flashing Blue: Release <br />
            Steady Green: Release complete / All Systems Nominal <br />
            Shimmering Red: Outage <br />
        </div>
        <script src="./ledController.js"></script>
        <script type="text/javascript">
            var socket = io.connect();
            var ledController = new LEDController();
            var currentTimeout = 0;

            socket.on('receivedIPs', function (data) {
                console.log(data);
                document.getElementById("IPAddresses").innerHTML = data.addresses;
            });

            function showValue(newValue)
            {
                document.getElementById("outputText").innerHTML=newValue;
            }

            function sendColor(color){
                socket.emit('sendColor',{value:color});
                console.log(color);
            }

            function sendRequest(){
                socket.emit('sendColor',
                    { color:document.getElementById('idColor').value,
                        pattern:document.getElementById('idPattern').options[document.getElementById('idPattern').selectedIndex].value,
                        frequency:document.getElementById('idFrequency').value
                    });
            }

            function showClientIPs() {
                socket.emit('showIPs', {value:''});
            }

            function submitRequest() {
                socket.emit('sendColor',
                    { color:document.getElementById('idColor').value,
                        pattern:document.getElementById('idPattern').options[document.getElementById('idPattern').selectedIndex].value,
                        frequency:document.getElementById('idFrequency').value,
                        destination:document.getElementById('idDestination').options[document.getElementById('idDestination').selectedIndex].value
                    });
            }

            socket.on('receivedColor', function (data) {
                clearTimeout(currentTimeout);
                ledController.setCurrentColors(data.color);
                ledController.current.pattern = data.pattern;
                ledController.current.frequency = data.frequency;
                currentTimeout = setInterval(loop, data.frequency);
            }) ;

            function setBackgroundColor(current) {
                var red = Math.floor(current.r).toString(16);
                var green = Math.floor(current.g).toString(16);
                var blue = Math.floor(current.b).toString(16);
                while (red.length < 2)
                    red = '0' + red;
                while (green.length < 2)
                    green = '0' + green;
                while (blue.length < 2)
                    blue = '0' + blue;
	
                var newColor = '#' + red + green + blue;
                document.getElementById('eyeColor').style.backgroundColor = newColor;
            }

            function loop() {
                setBackgroundColor(ledController.getPinSettings());
            }

        </script>
    </body>
</html>
